<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castle Town Hub - Deltarune Inspired</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="app">
        <!-- Auth Modal -->
        <div id="authModal" class="modal">
            <div class="modal-content">
                <h2 id="authTitle">Welcome to Castle Town</h2>
                <div id="authForm">
                    <input type="text" id="username" placeholder="Username" autocomplete="username">
                    <input type="password" id="password" placeholder="Password" autocomplete="current-password">
                    <div id="authError" class="error"></div>
                    <button id="loginBtn" class="btn">Login</button>
                    <button id="registerBtn" class="btn btn-secondary">Register</button>
                </div>
            </div>
        </div>

        <!-- Character Customization Modal -->
        <div id="characterModal" class="modal hidden">
            <div class="modal-content">
                <h2>Customize Your Character</h2>
                <div id="characterForm">
                    <div class="preview-container">
                        <canvas id="characterPreview" width="100" height="100"></canvas>
                    </div>
                    
                    <label for="characterColor">Color:</label>
                    <select id="characterColor">
                        <option value="#8b5fbf">Purple</option>
                        <option value="#5f8bbf">Blue</option>
                        <option value="#bf5f8b">Pink</option>
                        <option value="#5fbf8b">Green</option>
                        <option value="#bf8b5f">Orange</option>
                        <option value="#bf5f5f">Red</option>
                    </select>

                    <label for="characterStyle">Style:</label>
                    <select id="characterStyle">
                        <option value="round">Round</option>
                        <option value="square">Square</option>
                    </select>

                    <label for="characterDescription">Description:</label>
                    <textarea id="characterDescription" placeholder="A brief description of your character..." maxlength="200"></textarea>

                    <label for="characterParticularity">Particularity:</label>
                    <input type="text" id="characterParticularity" placeholder="What makes you special?" maxlength="100">

                    <label for="characterMessage">Speech Bubble:</label>
                    <input type="text" id="characterMessage" placeholder="Your message to the world..." maxlength="100">

                    <div class="option-group">
                        <label>üëï Tenue personnalis√©e</label>
                        <div class="costume-upload">
                            <img id="costume-preview" src="" alt="Aper√ßu tenue" style="display:none; width:100px; height:100px; object-fit:cover; margin:10px 0;">
                            <input type="file" id="costume-upload" accept="image/*">
                            <button id="upload-costume-btn" class="btn-small" type="button">Importer</button>
                            <button id="remove-costume-btn" class="btn-small" type="button">Retirer</button>
                        </div>
                    </div>

                    <div id="characterError" class="error"></div>
                    <button id="saveCharacterBtn" class="btn">Save Character</button>
                    <button id="cancelCharacterBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Main Town View -->
        <div id="townView" class="hidden">
            <div id="townContainer">
                <canvas id="townCanvas"></canvas>
            </div>

            <!-- Gallery Wall Controls (visible to all) -->
            <div id="gallery-wall" style="display:none;">
                <div id="gallery-display">
                    <button id="gallery-prev" class="gallery-nav">‚óÄ</button>
                    <div id="gallery-image-container">
                        <img id="current-gallery-image" src="" alt="Gallery" style="max-width:100%; max-height:100%; display:none;">
                    </div>
                    <button id="gallery-next" class="gallery-nav">‚ñ∂</button>
                </div>
                <div id="gallery-indicators"></div>
            </div>

            <!-- Top Bar -->
            <div id="topBar">
                <div id="userInfo">
                    <span id="currentUser"></span>
                    <button id="editCharacterBtn" class="btn-small">Edit Character</button>
                    <button id="logoutBtn" class="btn-small">Logout</button>
                </div>
            </div>

            <!-- Info Panel -->
            <div id="infoPanel" class="hidden">
                <button id="closeInfoBtn" class="close-btn">√ó</button>
                <h3 id="infoPanelName"></h3>
                <div id="infoPanelContent"></div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="hidden">
                <h3>Admin Controls</h3>
                <div id="adminControls">
                    <!-- NPC Creation -->
                    <div class="admin-section">
                        <h5>‚ûï Ajouter un habitant</h5>
                        <input type="text" id="new-player-name" placeholder="Nom du personnage" maxlength="50">
                        <input type="text" id="new-player-description" placeholder="Description" maxlength="200">
                        <button id="add-player-btn" class="btn-small">Cr√©er</button>
                    </div>

                    <p>Click on a character to select them</p>
                    <div id="selectedCharacter"></div>
                    
                    <div id="adminActions" class="hidden">
                        <!-- Golden Hearts -->
                        <div class="admin-section">
                            <h5>üíõ C≈ìurs Dor√©s</h5>
                            <div class="hearts-control">
                                <button id="remove-heart-btn" class="btn-small">-</button>
                                <span id="hearts-count">0</span>
                                <button id="add-heart-btn" class="btn-small">+</button>
                            </div>
                        </div>

                        <!-- Category Assignment -->
                        <div class="admin-section">
                            <h5>üè† Cat√©gorie</h5>
                            <select id="player-category">
                                <option value="">Sans cat√©gorie</option>
                            </select>
                            <button id="assign-category-btn" class="btn-small">Assigner</button>
                        </div>

                        <!-- Costume Upload (Admin) -->
                        <div class="admin-section">
                            <h5>üëï Tenue</h5>
                            <input type="file" id="admin-costume-upload" accept="image/*">
                            <button id="admin-upload-costume-btn" class="btn-small">Appliquer</button>
                            <button id="admin-remove-costume-btn" class="btn-small">Retirer</button>
                        </div>

                        <h4>Position</h4>
                        <div class="coordinates-section">
                            <div class="coord-inputs">
                                <div class="coord-field">
                                    <label for="coord-x">X:</label>
                                    <input type="number" id="coord-x" min="0" max="800" step="1" placeholder="X">
                                </div>
                                <div class="coord-field">
                                    <label for="coord-y">Y:</label>
                                    <input type="number" id="coord-y" min="0" max="600" step="1" placeholder="Y">
                                </div>
                            </div>
                            <button id="update-coords-btn" class="btn-small">Apply Coordinates</button>
                        </div>
                        <button id="moveCharacterBtn" class="btn-small">Enable Move Mode</button>
                        <p class="hint">Click on the town to move character</p>

                        <h4>Add Trait</h4>
                        <input type="text" id="traitInput" placeholder="New trait..." maxlength="100">
                        <button id="addTraitBtn" class="btn-small">Add Trait</button>

                        <h4>Add Item</h4>
                        <input type="text" id="itemInput" placeholder="New item..." maxlength="100">
                        <button id="addItemBtn" class="btn-small">Add Item</button>

                        <h4>Add History</h4>
                        <textarea id="historyInput" placeholder="History entry..." maxlength="200"></textarea>
                        <button id="addHistoryBtn" class="btn-small">Add History</button>

                        <h4>Add Interaction</h4>
                        <textarea id="interactionInput" placeholder="Interaction message..." maxlength="200"></textarea>
                        <button id="addInteractionBtn" class="btn-small">Add Interaction</button>
                    </div>

                    <!-- Category Management -->
                    <div id="categories-panel" class="admin-section">
                        <h4>üè† Cat√©gories</h4>
                        <div id="categories-list"></div>
                        <div class="add-category">
                            <input type="text" id="new-category-name" placeholder="Nom de la cat√©gorie" maxlength="50">
                            <input type="color" id="new-category-color" value="#7c5cbf">
                            <button id="add-category-btn" class="btn-small">Cr√©er</button>
                        </div>
                    </div>

                    <!-- Gallery Management -->
                    <div id="gallery-admin-panel" class="admin-section">
                        <h4>üñºÔ∏è Galerie du Mur</h4>
                        <div id="gallery-images-list"></div>
                        <div class="upload-section">
                            <input type="file" id="gallery-upload" accept="image/*" multiple>
                            <button id="upload-gallery-btn" class="btn-small">Ajouter des images</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/character.js"></script>
    <script src="/js/categories.js"></script>
    <script src="/js/gallery.js"></script>
    <script src="/js/town.js"></script>
    <script src="/js/admin.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
